version: "3.8"

networks:
    n8n:

volumes:
    n8n_data:
    nginx:

services:
    n8n:
        image: docker.n8n.io/n8nio/n8n
        environment:
            - N8N_BASIC_AUTH_ACTIVE=true
            - N8N_HOST=n8n
            - N8N_PORT=5678
            - N8N_PATH=/alliance/
            - N8N_ENDPOINT_WEBHOOK=/alliance/webhook
            - N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS=false
            - N8N_ENDPOINT_WEBHOOK_TEST=/alliance/webhook-test
            - N8N_SECURE_COOKIE=false

        volumes:
            - .:/home/node/.n8n
        restart: unless-stopped
        networks:
            - n8n

    nginx:
        image: nginx:latest
        ports:
            - "80:80"

        volumes:
            - ./nginx.conf:/etc/nginx/nginx.conf:ro  
        depends_on:
            - n8n
        networks:
            - n8n
